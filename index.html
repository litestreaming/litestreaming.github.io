<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Litestreaming</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <link href="https://vjs.zencdn.net/8.20.0/video-js.css" rel="stylesheet" />

    <style>
        .faq-content {
            transition: all 0.25s ease;
        }

        .glass {
            backdrop-filter: blur(12px);
            background: rgba(0, 0, 0, 0.6);
        }

        body.modal-open {
            overflow: hidden;
            height: 100vh;
        }

        @keyframes fadeUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-up {
            animation: fadeUp 0.6s ease forwards;
            opacity: 0;
        }

        [data-delay] {
            animation-delay: calc(var(--delay) * 0.1s);
        }


        .scroll-area {
            -webkit-overflow-scrolling: touch;
        }

        
        :focus-visible {
            outline: 1px solid #6366f1; 
            outline-offset: 2px;
            z-index: 50;
            border-radius: 0.5rem;
        }

        button.reset-btn {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            text-align: left;
            width: 100%;
            cursor: pointer;
            display: block;
        }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

    <nav class="fixed top-0 w-full z-20 backdrop-blur bg-white/30 dark:bg-gray-800/30 border-b border-gray-300/20">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <span class="font-bold text-lg md:text-xl">Litestreaming</span>
            <a href="https://discord.gg/dEmqkmK4" target="_blank"
                class="px-3 py-2 rounded-xl bg-indigo-600 text-white font-semibold focus:ring-4 focus:ring-indigo-300 outline-none">
                Discord
            </a>
        </div>
    </nav>
    
    <main class="pt-20 max-w-7xl mx-auto px-4">
        <h1 class="text-3xl md:text-4xl font-extrabold mb-4">Featured Shows</h1>
        <div id="posterGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4"></div>

        <h2 id="continueHeader" class="text-2xl md:text-3xl font-bold mt-12 mb-4 hidden">Continue Watching</h2>
        <div id="continueGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-12"></div>
    </main>

    <div id="showModal" class="fixed inset-0 hidden z-40">
        <div class="absolute inset-0 bg-black/70" onclick="closeShow()"></div>
        <div class="absolute inset-0 md:relative md:mt-20
            w-full md:max-w-5xl mx-auto
            glass rounded-2xl shadow-2xl
            max-h-[90vh] flex flex-col justify-start md:justify-start">

            <div id="showHero" class="h-48 md:h-72 bg-cover bg-center relative flex-shrink-0">
                <img id="showLogo" class="absolute bottom-3 left-4 h-12 md:h-20" />
                
                <button onclick="closeShow()" class="absolute top-4 right-4 bg-black/60 text-white px-3 py-1 rounded-full text-sm font-bold focus:bg-red-600 outline-none">
                    Close ✕
                </button>
            </div>

            <div class="p-4 md:p-6 space-y-4 overflow-y-auto scroll-area">
                <p id="showSummary" class="text-gray-300 text-sm md:text-base max-w-3xl fade-up" data-delay="0"></p>

                <select id="seasonSelect" class="bg-gray-800 p-3 rounded-xl w-full md:w-64 text-white fade-up focus:ring-4 focus:ring-indigo-500 outline-none"
                    data-delay="1"></select>

                <div id="episodeGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 fade-up"
                    data-delay="2"></div>

            </div>
        </div>
    </div>

    <div id="playerModal" class="fixed inset-0 hidden z-50 flex items-center justify-center">
        <div class="absolute inset-0 bg-black/95" onclick="closePlayer()"></div>

        <div class="relative w-full md:max-w-6xl mx-auto h-full md:h-auto flex flex-col items-center justify-center p-4">
             <button onclick="closePlayer()" class="self-end mb-2 px-6 py-2 bg-red-600 text-white font-bold rounded-lg z-50 focus:ring-4 focus:ring-white outline-none">
                Close Player
            </button>

            <div class="relative w-full aspect-video bg-black rounded-xl overflow-hidden shadow-2xl">
                <video id="playerVideo" class="w-full h-full" controls playsinline preload="metadata">
                </video>
            </div>
        </div>
    </div>

    <div id="comingSoonModal" class="fixed inset-0 hidden z-50 flex items-center justify-center">
        <div class="absolute inset-0 bg-black/80" onclick="closeComingSoon()"></div>

        <div class="relative w-full max-w-lg mx-4
            glass rounded-2xl shadow-2xl
            flex flex-col overflow-hidden">

            <div id="comingSoonHero" class="h-48 bg-cover bg-center relative">
                <img id="comingSoonLogo" class="absolute bottom-3 left-4 h-12" />
                <button onclick="closeComingSoon()" class="absolute top-2 right-2 bg-black/50 text-white rounded-full p-2 text-xs">✕</button>
            </div>

            <div class="p-6 text-center space-y-4">
                <h2 id="comingSoonTitle" class="text-2xl font-extrabold"></h2>

                <p id="comingSoonNote" class="text-gray-300 text-sm">
                </p>

                <span class="inline-block px-4 py-2 rounded-full
               bg-indigo-600/90 text-white
               text-sm font-bold tracking-wide">
                    Coming Soon
                </span>
                
                <button onclick="closeComingSoon()" class="block w-full mt-4 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-bold">Close</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script>
        let shows = [];
        let currentShow = null;
        let currentSeasonData = null;
        let hls = null;
        let lastFocusedElement = null; 

        fetch("data/show.json?v=" + Date.now())
            .then(res => res.json())
            .then(data => {
                shows = data.shows;
                renderPosters();
                renderContinueWatching();
            });

        function toggleFAQ(button) {
            const item = button.parentElement;
            const content = item.querySelector(".faq-content");
            const icon = item.querySelector(".faq-icon");

            content.classList.toggle("hidden");
            icon.textContent = content.classList.contains("hidden") ? "+" : "−";
        }


        function openComingSoon(index) {
            lastFocusedElement = document.activeElement;
            const show = shows[index];
            document.body.classList.add("modal-open");

            comingSoonHero.style.backgroundImage = `url(${show.banner})`;
            comingSoonLogo.src = show.logo || "";
            comingSoonTitle.textContent = show.title;
            comingSoonNote.textContent = show.comingSoonNote || "This title is coming soon.";

            comingSoonModal.classList.remove("hidden");

            const items = comingSoonModal.querySelectorAll(
                ".fade-up, #comingSoonHero, #comingSoonTitle, #comingSoonNote");
            items.forEach((el, i) => {
                el.classList.add("fade-up");
                el.style.animationDelay = `${i * 0.1}s`;
            });

            setTimeout(() => {
                const closeBtn = comingSoonModal.querySelector('button:last-child');
                if(closeBtn) closeBtn.focus();
            }, 100);
        }


        function closeComingSoon() {
            comingSoonModal.classList.add("hidden");
            document.body.classList.remove("modal-open");
            if(lastFocusedElement) lastFocusedElement.focus();
        }

        function renderPosters() {
            posterGrid.innerHTML = shows.map((show, i) => `
    <button class="reset-btn relative group fade-up rounded-xl transition-transform active:scale-95 focus:scale-105" 
        style="--delay:${i}"
        onclick="${show.comingSoon ? `openComingSoon(${i})` : `openShow(${i})`}">
      
      ${show.newEpisodes ? `
        <div class="absolute top-2 right-2 z-10 bg-red-600 text-white text-[10px] md:text-xs font-bold px-2 py-1 rounded shadow-md pointer-events-none">
            NEW EPISODES
        </div>
      ` : ''}

      <img src="${show.poster}"
        class="rounded-xl shadow-lg w-full h-auto object-cover
               ${show.comingSoon ? 'opacity-70' : ''}" />

      ${show.comingSoon ? `
        <div class="absolute inset-0 rounded-xl
                    bg-black/60 backdrop-blur-sm
                    flex items-center justify-center pointer-events-none">
          <span class="px-4 py-2 rounded-full
                       bg-indigo-600/90 text-white
                       text-sm font-bold tracking-wide shadow-lg">
            ${show.comingSoonText || "Coming Soon"}
          </span>
        </div>
      ` : ''}
    </button>
  `).join("");
        }


        function openShow(index) {
            lastFocusedElement = document.activeElement;
            currentShow = shows[index];
            document.body.classList.add("modal-open");

            showHero.style.backgroundImage = `url(${currentShow.banner})`;
            showLogo.src = currentShow.logo;
            showSummary.textContent = currentShow.summary;

            seasonSelect.innerHTML = currentShow.seasons.map((s, i) =>
                `<option value="${i}">Season ${s.number}</option>`
            ).join("");

            seasonSelect.onchange = () => loadSeason(seasonSelect.value);
            loadSeason(0);

            showModal.classList.remove("hidden");

            const items = showModal.querySelectorAll(".fade-up");
            items.forEach((el, i) => {
                el.style.animationDelay = `${i * 0.1}s`;
                el.classList.add("fade-up");
            });

            setTimeout(() => {
                seasonSelect.focus();
            }, 150);
        }


        function loadSeason(seasonIndex) {
            episodeGrid.innerHTML = "<p class='text-gray-400 p-2'>Loading...</p>";

            fetch(currentShow.seasons[seasonIndex].file + "?v=" + Date.now())
                .then(res => res.json())
                .then(data => {
                    currentSeasonData = data;

                    if (data.type === "external") {
                        renderExternalSeason(data);
                    } else {
                        renderEpisodes();
                    }
                });
        }

        function renderExternalSeason(data) {
            episodeGrid.innerHTML = `
    <div class="col-span-full flex flex-col items-center justify-center text-center py-16 space-y-4">
      <a href="${data.button.url}" target="_blank"
        class="px-10 py-5 text-xl font-bold rounded-2xl
               bg-indigo-600 hover:bg-indigo-700 text-white
               transition hover:scale-105 shadow-xl inline-block focus:ring-4 focus:ring-white">
        ${data.button.label}
      </a>
      <p class="text-sm text-gray-400 max-w-md">
        ${data.note}
      </p>
    </div>
  `;
        }

        function renderContinueWatching() {
            const watchData = JSON.parse(localStorage.getItem("continueWatching") || "[]");
            const grid = document.getElementById("continueGrid");
            const header = document.getElementById("continueHeader");

            if (!grid) return;

            if(watchData.length === 0) {
                header.classList.add("hidden");
                grid.innerHTML = "";
                return;
            } else {
                header.classList.remove("hidden");
            }

            const items = watchData.map(item => {
                const show = shows.find(s => s.id === item.showId);
                if (!show) return null;

                const minutes = Math.floor(item.time / 60);
                const progressText = minutes > 0 ? `${minutes}m watched` : 'Just started';

                return `
      <button class="reset-btn rounded-xl shadow-lg overflow-hidden relative group transition-transform active:scale-95 focus:scale-105" 
              onclick="openShow(${shows.indexOf(show)})">
        <img src="${show.poster}" class="w-full h-32 object-cover">
        
        <div class="absolute bottom-0 w-full bg-black/80 backdrop-blur-md p-2 flex justify-between items-center">
            <span class="text-white text-xs font-medium">S${item.season + 1} E${item.episode + 1}</span>
            <span class="text-gray-300 text-[10px]">${progressText}</span>
        </div>

        <div class="absolute top-2 left-2 bg-indigo-600 text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-sm">
            RESUME
        </div>
      </button>
    `;
            }).filter(Boolean);

            grid.innerHTML = items.join("");
        }


        function renderEpisodes() {
            episodeGrid.innerHTML = currentSeasonData.episodes.map((ep, i) => `
    <button onclick="openPlayer(${i})" 
      class="reset-btn bg-gray-800 rounded-xl overflow-hidden cursor-pointer active:scale-95 transition fade-up flex flex-col focus:ring-4 focus:ring-indigo-500"
      style="--delay:${i}">
      <img src="${ep.thumbnail}" class="w-full h-28 object-cover">
      <div class="p-2 w-full">
        <p class="text-xs text-gray-400">Episode ${ep.number}</p>
        <p class="font-semibold text-sm truncate">${ep.title}</p>
      </div>
    </button>
  `).join("");
        }

        function openPlayer(epIndex) {
            const ep = currentSeasonData.episodes[epIndex];
            const video = document.getElementById("playerVideo");
            const videoSrc = ep.embed;

            let watchData = JSON.parse(localStorage.getItem("continueWatching") || "[]");
            const currentShowId = currentShow.id;
            const currentSeasonNum = parseInt(seasonSelect.value);

            const existingEntry = watchData.find(item =>
                item.showId === currentShowId &&
                item.season === currentSeasonNum &&
                item.episode === epIndex
            );

            let startTime = existingEntry ? existingEntry.time : 0;

            video.ontimeupdate = () => {
                const currentTime = video.currentTime;
                if (currentTime > 0) {
                    saveProgress(currentShowId, currentSeasonNum, epIndex, currentTime);
                }
            };

            video.pause();
            video.src = "";
            while (video.firstChild) {
                video.removeChild(video.firstChild);
            }

            if (hls) {
                hls.destroy();
                hls = null;
            }

            if (ep.subtitles && ep.subtitles.length > 0) {
                ep.subtitles.forEach(track => {
                    const t = document.createElement("track");
                    t.kind = "subtitles";
                    t.label = track.label;
                    t.srclang = track.lang;
                    t.src = track.url;
                    if (track.default) t.default = true;
                    video.appendChild(t);
                });
            }

            const onVideoReady = () => {
                if (startTime > 0) {
                    video.currentTime = startTime;
                }
                video.play().catch(e => console.log("Auto-play prevented:", e));
            };

            if (videoSrc.includes('.mp4') || videoSrc.includes('.webm') || videoSrc.includes('.ogg')) {
                video.src = videoSrc;
                video.addEventListener('loadedmetadata', onVideoReady, { once: true });
            }
            else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = videoSrc;
                video.addEventListener('loadedmetadata', onVideoReady, { once: true });
            }
            else if (Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(videoSrc);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                   onVideoReady();
                });
            } else {
                alert("Your browser does not support HLS playback.");
                return;
            }

            saveProgress(currentShowId, currentSeasonNum, epIndex, startTime);

            playerModal.classList.remove("hidden");
            
            setTimeout(() => video.focus(), 200);
        }

        function saveProgress(showId, season, episode, time) {
            let watchData = JSON.parse(localStorage.getItem("continueWatching") || "[]");
            
            watchData = watchData.filter(item => item.showId !== showId);

            watchData.unshift({
                showId: showId,
                season: season,
                episode: episode,
                time: time,
                lastUpdated: Date.now()
            });

            if(watchData.length > 10) watchData.pop();

            localStorage.setItem("continueWatching", JSON.stringify(watchData));
        }

        function closeShow() {
            showModal.classList.add("hidden");
            document.body.classList.remove("modal-open");
            renderContinueWatching(); 
            if(lastFocusedElement) lastFocusedElement.focus();
        }

        function closePlayer() {
            const video = document.getElementById("playerVideo");
            
            video.ontimeupdate = null; 

            video.pause();
            video.src = "";
            if (hls) {
                hls.destroy();
                hls = null;
            }
            playerModal.classList.add("hidden");
            
            renderContinueWatching();
            
            setTimeout(() => {
                const buttons = episodeGrid.querySelectorAll('button');
                if (buttons.length > 0) buttons[0].focus();
            }, 100);
        }
    </script>
    
    <section class="max-w-6xl mx-auto px-6 py-24">
        <h2 class="text-4xl font-extrabold mb-10 text-center">
            FAQ
        </h2>

        <div class="space-y-4">

            <div class="faq-item rounded-xl bg-white/70 dark:bg-gray-800/70 backdrop-blur shadow-md">
                <button class="w-full px-6 py-5 flex justify-between items-center text-left font-semibold text-lg focus:ring-4 focus:ring-indigo-500 rounded-xl outline-none"
                    onclick="toggleFAQ(this)">
                    <span>What is this site?</span>
                    <span class="faq-icon text-xl">+</span>
                </button>

                <div class="faq-content hidden px-6 pb-5 text-gray-600 dark:text-gray-300">
                    This site is a website you can stream most LEGO TV shows on.
                </div>
            </div>


            <div class="faq-item rounded-xl bg-white/70 dark:bg-gray-800/70 backdrop-blur shadow-md">
                <button class="w-full px-6 py-5 flex justify-between items-center text-left font-semibold text-lg focus:ring-4 focus:ring-indigo-500 rounded-xl outline-none"
                    onclick="toggleFAQ(this)">
                    <span>Where does the video content come from?</span>
                    <span class="faq-icon text-xl">+</span>
                </button>

                <div class="faq-content hidden px-6 pb-5 text-gray-600 dark:text-gray-300">
                    Videos are embedded or streamed from official sources.
                </div>
            </div>

            <div class="faq-item rounded-xl bg-white/70 dark:bg-gray-800/70 backdrop-blur shadow-md">
                <button class="w-full px-6 py-5 flex justify-between items-center text-left font-semibold text-lg focus:ring-4 focus:ring-indigo-500 rounded-xl outline-none"
                    onclick="toggleFAQ(this)">
                    <span>Why is some content marked as “Coming Soon”?</span>
                    <span class="faq-icon text-xl">+</span>
                </button>

                <div class="faq-content hidden px-6 pb-5 text-gray-600 dark:text-gray-300">
                    Some shows or seasons are still being prepared and will be available at a later date.
                </div>
            </div>

            <div class="faq-item rounded-xl bg-white/70 dark:bg-gray-800/70 backdrop-blur shadow-md">
                <button class="w-full px-6 py-5 flex justify-between items-center text-left font-semibold text-lg focus:ring-4 focus:ring-indigo-500 rounded-xl outline-none"
                    onclick="toggleFAQ(this)">
                    <span>How do I suggest a new feature to the website?</span>
                    <span class="faq-icon text-xl">+</span>
                </button>

                <div class="faq-content hidden px-6 pb-5 text-gray-600 dark:text-gray-300">
                    Join the Discord server.
                </div>
            </div>

        </div>
    </section>

</body>

</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Litestreaming</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <link href="https://vjs.zencdn.net/8.20.0/video-js.css" rel="stylesheet" />

    <style>
        .faq-content {
            transition: all 0.25s ease;
        }

        .glass {
            backdrop-filter: blur(12px);
            background: rgba(0, 0, 0, 0.6);
        }

        body.modal-open {
            overflow: hidden;
            height: 100vh;
        }

        @keyframes fadeUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-up {
            animation: fadeUp 0.6s ease forwards;
            opacity: 0;
        }

        [data-delay] {
            animation-delay: calc(var(--delay) * 0.1s);
        }


        .scroll-area {
            -webkit-overflow-scrolling: touch;
        }

        
:focus-visible {
    outline: 1px solid #6366f1; 
    outline-offset: 2px;
    z-index: 10; 
    border-radius: 0.5rem;
}

        button.reset-btn {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            text-align: left;
            width: 100%;
            cursor: pointer;
            display: block;
        }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

<nav class="fixed top-0 w-full z-20 backdrop-blur bg-white/30 dark:bg-gray-800/30 border-b border-gray-300/20">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center gap-4">
            <span class="font-bold text-lg md:text-xl shrink-0">Litestreaming</span>
            
            <input type="text" id="searchInput" placeholder="Search shows..." 
                class="flex-1 max-w-md px-4 py-1.5 rounded-xl bg-white/20 dark:bg-black/20 border border-gray-400/20 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">

            <a href="https://discord.gg/jmeYYbBcsN" target="_blank"
                class="px-3 py-2 rounded-xl bg-indigo-600 text-white font-semibold focus:ring-4 focus:ring-indigo-300 outline-none shrink-0">
                Discord
            </a>
        </div>
    </nav>
    
<section id="heroSection" class="pt-20 max-w-7xl mx-auto px-4 hidden">
    <div id="heroContainer" class="relative w-full h-[300px] md:h-[450px] rounded-2xl overflow-hidden shadow-2xl bg-gray-800">
        </div>
</section>

    <main class="pt-20 max-w-7xl mx-auto px-4">
        <h1 class="text-3xl md:text-4xl font-extrabold mb-4">Featured Shows</h1>
        <div id="posterGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4"></div>

        <h2 id="continueHeader" class="text-2xl md:text-3xl font-bold mt-12 mb-4 hidden">Continue Watching</h2>
        <div id="continueGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-12"></div>
    </main>

    <div id="showModal" class="fixed inset-0 hidden z-40">
        <div class="absolute inset-0 bg-black/70" onclick="closeShow()"></div>
        <div class="absolute inset-0 md:relative md:mt-20
            w-full md:max-w-5xl mx-auto
            glass rounded-2xl shadow-2xl
            max-h-[90vh] flex flex-col justify-start md:justify-start">

<div id="showHero" class="h-48 md:h-72 bg-cover bg-center relative flex-shrink-0 overflow-hidden">
    <video id="showPreviewVideo" class="absolute inset-0 w-full h-full object-cover hidden opacity-0 transition-opacity duration-1000" muted playsinline loop></video>
    
    <img id="showLogo" class="absolute bottom-3 left-4 h-12 md:h-20 z-10" />
    
    <button onclick="closeShow()" class="absolute top-4 right-4 bg-black/60 text-white px-3 py-1 rounded-full text-sm font-bold focus:bg-red-600 outline-none z-10">
        Close ✕
    </button>
</div>

            <div class="p-4 md:p-6 space-y-4 overflow-y-auto scroll-area">
<div class="p-4 md:p-6 space-y-4 overflow-y-auto scroll-area">
    <div id="seasonComingSoon" class="hidden flex flex-wrap gap-2 fade-up"></div>

    <p id="showSummary" class="text-gray-300 text-sm md:text-base max-w-3xl fade-up" data-delay="0"></p>

    <select id="seasonSelect" class="bg-gray-800 p-3 rounded-xl w-full md:w-64 text-white fade-up focus:ring-4 focus:ring-indigo-500 outline-none" data-delay="1"></select>

    <div id="episodeGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 fade-up" data-delay="2"></div>
</div>

            </div>
        </div>
    </div>
<div id="playerModal" class="fixed inset-0 hidden z-[100] flex items-center justify-center">
        <div class="absolute inset-0 bg-black/95" onclick="closePlayer()"></div>

        <div class="relative w-full md:max-w-6xl mx-auto h-full md:h-auto flex flex-col items-center justify-center p-4">
             <button onclick="closePlayer()" class="self-end mb-2 px-6 py-2 bg-red-600 text-white font-bold rounded-lg z-50 focus:ring-4 focus:ring-white outline-none">
                Close Player
            </button>
<div class="relative w-full aspect-video bg-black rounded-xl overflow-hidden shadow-2xl group">
<video id="playerVideo" class="w-full h-full hidden" controls playsinline preload="metadata"></video>
    
    <iframe id="playerYoutube" class="hidden absolute inset-0 w-full h-full" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            allowfullscreen></iframe>

    <button id="nextEpOverlay" onclick="playNextEpisode()"
                    class="hidden absolute bottom-20 right-8 z-50 flex items-center gap-3 p-1 pr-6 bg-indigo-600/90 hover:bg-indigo-500 text-white rounded-xl backdrop-blur-md transition-all transform hover:scale-105 border border-white/20 shadow-2xl fade-up">
                    <img id="nextEpPreview" src="" class="w-20 h-12 object-cover rounded-lg">
                    <div class="text-left">
                        <p class="text-[10px] font-bold opacity-70 uppercase tracking-widest">Next Episode</p>
                        <p id="nextEpTitle" class="text-sm font-bold truncate max-w-[150px]"></p>
                    </div>
                    <span class="ml-2">❯</span>
                </button>
            </div>
        </div>
    </div> <div id="epInfoModal" class="fixed inset-0 hidden z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80" onclick="closeEpInfo()"></div>
        <div class="relative w-full max-w-2xl glass rounded-2xl overflow-hidden shadow-2xl flex flex-col fade-up">
            
            <div class="relative h-48 md:h-64 bg-black">
                <img id="epInfoThumb" class="w-full h-full object-cover opacity-80" src="" alt="">
                <button onclick="closeEpInfo()" class="absolute top-4 right-4 bg-black/60 text-white p-2 rounded-full hover:bg-red-600 transition">✕</button>
            </div>

            <div class="p-6 space-y-4">
                <div>
                    <h3 id="epInfoTitle" class="text-2xl font-bold text-white"></h3>
                    <p id="epInfoMeta" class="text-indigo-400 text-sm font-semibold uppercase tracking-wider"></p>
                </div>
                
                <p id="epInfoSynopsis" class="text-gray-300 text-sm leading-relaxed"></p>
                
                <div class="flex items-center gap-6 pt-4 border-t border-white/10 text-xs font-mono text-gray-400">
                    <div class="flex items-center gap-2">
                        <span>LENGTH:</span>
                        <span id="epInfoLength" class="text-white">Calculating...</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span>QUALITY:</span>
                        <span class="text-white">HD</span>
                    </div>
                </div>

                <button id="epInfoPlayBtn" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl transition-all active:scale-95">
                    Play Episode
                </button>
            </div>
        </div>
    </div>

    <div id="comingSoonModal" class="fixed inset-0 hidden z-50 flex items-center justify-center">
        <div class="absolute inset-0 bg-black/80" onclick="closeComingSoon()"></div>

        <div class="relative w-full max-w-lg mx-4
            glass rounded-2xl shadow-2xl
            flex flex-col overflow-hidden">

            <div id="comingSoonHero" class="h-48 bg-cover bg-center relative">
                <img id="comingSoonLogo" class="absolute bottom-3 left-4 h-12" />
                <button onclick="closeComingSoon()" class="absolute top-2 right-2 bg-black/50 text-white rounded-full p-2 text-xs">✕</button>
            </div>

            <div class="p-6 text-center space-y-4">
                <h2 id="comingSoonTitle" class="text-2xl font-extrabold"></h2>

                <p id="comingSoonNote" class="text-gray-300 text-sm">
                </p>

                <span class="inline-block px-4 py-2 rounded-full
               bg-indigo-600/90 text-white
               text-sm font-bold tracking-wide">
                    Coming Soon
                </span>
                
                <button onclick="closeComingSoon()" class="block w-full mt-4 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-bold">Close</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script>
        let shows = [];
        let currentShow = null;
        let currentSeasonData = null;
        let hls = null;
        let lastFocusedElement = null; 
        let previewTimer = null;

        fetch("data/show.json?v=" + Date.now())
            .then(res => res.json())
            .then(data => {
                shows = data.shows;
                renderPosters();
                renderContinueWatching();
            });

        function toggleFAQ(button) {
            const item = button.parentElement;
            const content = item.querySelector(".faq-content");
            const icon = item.querySelector(".faq-icon");

            content.classList.toggle("hidden");
            icon.textContent = content.classList.contains("hidden") ? "+" : "−";
        }


        function openComingSoon(index) {
            lastFocusedElement = document.activeElement;
            const show = shows[index];
            document.body.classList.add("modal-open");

            comingSoonHero.style.backgroundImage = `url(${show.banner})`;
            comingSoonLogo.src = show.logo || "";
            comingSoonTitle.textContent = show.title;
            comingSoonNote.textContent = show.comingSoonNote || "This title is coming soon.";

            comingSoonModal.classList.remove("hidden");

            const items = comingSoonModal.querySelectorAll(
                ".fade-up, #comingSoonHero, #comingSoonTitle, #comingSoonNote");
            items.forEach((el, i) => {
                el.classList.add("fade-up");
                el.style.animationDelay = `${i * 0.1}s`;
            });

            setTimeout(() => {
                const closeBtn = comingSoonModal.querySelector('button:last-child');
                if(closeBtn) closeBtn.focus();
            }, 100);
        }


        function closeComingSoon() {
            comingSoonModal.classList.add("hidden");
            document.body.classList.remove("modal-open");
            if(lastFocusedElement) lastFocusedElement.focus();
        }

        function renderPosters(list = shows) {
            const grid = document.getElementById("posterGrid");
            
            if (list.length === 0) {
                grid.innerHTML = `<p class="col-span-full text-center py-10 text-gray-500">No shows found.</p>`;
                return;
            }

            grid.innerHTML = list.map((show) => {
                const originalIndex = shows.indexOf(show);
                
                return `
                <button class="reset-btn relative group fade-up rounded-xl transition-transform active:scale-95 focus:scale-105" 
                    style="--delay:${list.indexOf(show)}"
                    onclick="${show.comingSoon ? `openComingSoon(${originalIndex})` : `openShow(${originalIndex})`}">
                  
                  ${show.newEpisodes ? `
                    <div class="absolute top-2 right-2 z-10 bg-red-600 text-white text-[10px] md:text-xs font-bold px-2 py-1 rounded shadow-md pointer-events-none">
                        NEW EPISODES
                    </div>
                  ` : ''}

                  <img src="${show.poster}"
                    class="rounded-xl shadow-lg w-full h-auto object-cover
                           ${show.comingSoon ? 'opacity-70' : ''}" />

                  ${show.comingSoon ? `
                    <div class="absolute inset-0 rounded-xl
                                bg-black/60 backdrop-blur-sm
                                flex items-center justify-center pointer-events-none">
                      <span class="px-4 py-2 rounded-full
                                   bg-indigo-600/90 text-white
                                   text-sm font-bold tracking-wide shadow-lg">
                        ${show.comingSoonText || "Coming Soon"}
                      </span>
                    </div>
                  ` : ''}
                </button>
              `;
            }).join("");
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = shows.filter(show => 
                show.title.toLowerCase().includes(term)
            );
            renderPosters(filtered);
        });

function openShow(index) {
    lastFocusedElement = document.activeElement;
    currentShow = shows[index];
    document.body.classList.add("modal-open");

    const videoEl = document.getElementById("showPreviewVideo");
    
    // Reset video state
    clearTimeout(previewTimer);
    videoEl.pause();
    videoEl.src = "";
    videoEl.classList.add("hidden");
    videoEl.style.opacity = "0";

    showHero.style.backgroundImage = `url(${currentShow.banner})`;
    showLogo.src = currentShow.logo;
    showSummary.textContent = currentShow.summary;

    // --- PREVIEW LOGIC ---
    if (currentShow.preview) {
        previewTimer = setTimeout(() => {
            videoEl.src = currentShow.preview;
            videoEl.classList.remove("hidden");
            videoEl.play().then(() => {
                videoEl.style.opacity = "1"; // Smooth fade in
            }).catch(e => console.log("Preview autoplay blocked"));
        }, 5000); // 5 second delay
    }
    // ---------------------

    const comingSoonArea = document.getElementById("seasonComingSoon");
    comingSoonArea.innerHTML = ""; 
    comingSoonArea.classList.add("hidden");

    const comingSoonSeasons = currentShow.seasons.filter(s => s.comingSoonText);
    if (comingSoonSeasons.length > 0) {
        comingSoonArea.classList.remove("hidden");
        comingSoonArea.innerHTML = comingSoonSeasons.map(s => `
            <span class="px-3 py-1 bg-indigo-600/30 border border-indigo-500/50 text-indigo-300 text-xs font-bold rounded-lg">
                ${s.comingSoonText}
            </span>
        `).join("");
    }

    const playableSeasons = currentShow.seasons.filter(s => s.file);
    
    if (playableSeasons.length > 0) {
        seasonSelect.classList.remove("hidden");
        seasonSelect.innerHTML = playableSeasons.map((s, i) =>
            `<option value="${i}">Season ${s.number}</option>`
        ).join("");

        seasonSelect.onchange = () => {
            const actualIndexInShow = currentShow.seasons.indexOf(playableSeasons[seasonSelect.value]);
            loadSeason(actualIndexInShow);
        };
        
        const firstSeasonIndex = currentShow.seasons.indexOf(playableSeasons[0]);
        loadSeason(firstSeasonIndex);
    } else {
        seasonSelect.classList.add("hidden");
        episodeGrid.innerHTML = "<p class='text-gray-500 p-4'>No episodes currently available.</p>";
    }

    showModal.classList.remove("hidden");

    const items = showModal.querySelectorAll(".fade-up");
    items.forEach((el, i) => {
        el.style.animationDelay = `${i * 0.1}s`;
        el.classList.add("fade-up");
    });

    setTimeout(() => {
        if (!seasonSelect.classList.contains("hidden")) seasonSelect.focus();
    }, 150);
}

        function loadSeason(seasonIndex) {
            episodeGrid.innerHTML = "<p class='text-gray-400 p-2'>Loading...</p>";

            fetch(currentShow.seasons[seasonIndex].file + "?v=" + Date.now())
                .then(res => res.json())
                .then(data => {
                    currentSeasonData = data;

                    if (data.type === "external") {
                        renderExternalSeason(data);
                    } else {
                        renderEpisodes();
                    }
                });
        }

        function renderExternalSeason(data) {
            episodeGrid.innerHTML = `
    <div class="col-span-full flex flex-col items-center justify-center text-center py-16 space-y-4">
      <a href="${data.button.url}" target="_blank"
        class="px-10 py-5 text-xl font-bold rounded-2xl
               bg-indigo-600 hover:bg-indigo-700 text-white
               transition hover:scale-105 shadow-xl inline-block focus:ring-4 focus:ring-white">
        ${data.button.label}
      </a>
      <p class="text-sm text-gray-400 max-w-md">
        ${data.note}
      </p>
    </div>
  `;
        }

        function renderContinueWatching() {
            const watchData = JSON.parse(localStorage.getItem("continueWatching") || "[]");
            const grid = document.getElementById("continueGrid");
            const header = document.getElementById("continueHeader");

            if (!grid) return;

            if(watchData.length === 0) {
                header.classList.add("hidden");
                grid.innerHTML = "";
                return;
            } else {
                header.classList.remove("hidden");
            }

            const items = watchData.map(item => {
                const show = shows.find(s => s.id === item.showId);
                if (!show) return null;

                const minutes = Math.floor(item.time / 60);
                const progressText = minutes > 0 ? `${minutes}m watched` : 'Just started';

                return `
      <button class="reset-btn rounded-xl shadow-lg overflow-hidden relative group transition-transform active:scale-95 focus:scale-105" 
              onclick="openShow(${shows.indexOf(show)})">
        <img src="${show.poster}" class="w-full h-32 object-cover">
        
        <div class="absolute bottom-0 w-full bg-black/80 backdrop-blur-md p-2 flex justify-between items-center">
            <span class="text-white text-xs font-medium">S${item.season + 1} E${item.episode + 1}</span>
            <span class="text-gray-300 text-[10px]">${progressText}</span>
        </div>

        <div class="absolute top-2 left-2 bg-indigo-600 text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-sm">
            RESUME
        </div>
      </button>
    `;
            }).filter(Boolean);

            grid.innerHTML = items.join("");
        }


function renderEpisodes() {
    episodeGrid.innerHTML = currentSeasonData.episodes.map((ep, i) => `
        <div class="relative group fade-up" style="--delay:${i}">
            <button onclick="openPlayer(${i})" 
                class="reset-btn bg-gray-800 rounded-xl overflow-hidden cursor-pointer active:scale-95 transition flex flex-col focus:ring-4 focus:ring-indigo-500">
                <img src="${ep.thumbnail}" class="w-full h-28 object-cover">
                <div class="p-2 w-full">
                    <p class="text-xs text-gray-400">Episode ${ep.number}</p>
                    <p class="font-semibold text-sm truncate">${ep.title}</p>
                </div>
            </button>

            <button onclick="event.stopPropagation(); openEpisodeInfo(${i})" 
                class="absolute top-2 right-2 p-1.5 bg-black/60 hover:bg-indigo-600 text-white rounded-full backdrop-blur-md transition-colors shadow-lg"
                title="Episode Info">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>
        </div>
    `).join("");
}

function openEpisodeInfo(epIndex) {
    const ep = currentSeasonData.episodes[epIndex];
    
    document.getElementById("epInfoThumb").src = ep.thumbnail;
    document.getElementById("epInfoTitle").textContent = ep.title;
    document.getElementById("epInfoSynopsis").textContent = ep.description || "No synopsis available for this episode.";
    document.getElementById("epInfoMeta").textContent = `Season ${currentShow.seasons[seasonSelect.value].number} • Episode ${ep.number}`;
    document.getElementById("epInfoLength").textContent = "Calculating...";

    document.getElementById("epInfoPlayBtn").onclick = () => {
        closeEpInfo();
        openPlayer(epIndex);
    };

    document.getElementById("epInfoModal").classList.remove("hidden");

    getDuration(ep.embed, (duration) => {
        document.getElementById("epInfoLength").textContent = duration;
    });
}

function closeEpInfo() {
    document.getElementById("epInfoModal").classList.add("hidden");
}

function getDuration(url, callback) {
    if (!url) return callback("Unknown");

    const tempVideo = document.createElement('video');
    
    const formatTime = (duration) => {
        if (!duration || !isFinite(duration)) return "N/A";
        const mins = Math.floor(duration / 60);
        const secs = Math.floor(duration % 60);
        return `${mins}m ${secs}s`;
    };

    if (url.includes('.m3u8') && Hls.isSupported()) {
        const hlsTemp = new Hls();
        hlsTemp.loadSource(url);
        hlsTemp.attachMedia(tempVideo);
        
        hlsTemp.on(Hls.Events.MANIFEST_PARSED, function() {
            setTimeout(() => {
                callback(formatTime(tempVideo.duration));
                hlsTemp.destroy();
                tempVideo.remove();
            }, 600);
        });

        hlsTemp.on(Hls.Events.ERROR, function() {
            callback("N/A");
            hlsTemp.destroy();
            tempVideo.remove();
        });
    } 
    else {
        tempVideo.preload = 'metadata';
        tempVideo.src = url;
        
        tempVideo.onloadedmetadata = () => {
            callback(formatTime(tempVideo.duration));
            tempVideo.remove();
        };

        tempVideo.onerror = () => {
            callback("N/A");
            tempVideo.remove();
        };
    }
}

let currentEpisodeIndex = -1; 

function playNextEpisode() {
    if (currentEpisodeIndex < currentSeasonData.episodes.length - 1) {
        openPlayer(currentEpisodeIndex + 1);
    } else {
        alert("You've reached the end of the season!");
        closePlayer();
    }
}

function playPreviousEpisode() {
    if (currentEpisodeIndex > 0) {
        openPlayer(currentEpisodeIndex - 1);
    }
}

function openPlayer(epIndex) {
    currentEpisodeIndex = epIndex; 
    const ep = currentSeasonData.episodes[epIndex];
    const video = document.getElementById("playerVideo");
    const ytPlayer = document.getElementById("playerYoutube"); 
    const videoContainer = video.parentElement; 
    const videoSrc = ep.embed;

    const oldError = videoContainer.querySelector('.unavailable-msg');
    if (oldError) oldError.remove();
    
    video.classList.add("hidden");
    ytPlayer.classList.add("hidden");
    
    video.pause();
    video.src = "";
    video.load();
    if (hls) { hls.destroy(); hls = null; }

    ytPlayer.src = "";

    if (!videoSrc || videoSrc.trim() === "") {
        showPlayerError(videoContainer);
        return; 
    }

    const isEmbed = videoSrc.includes("youtube.com") || videoSrc.includes("youtu.be") || videoSrc.includes("embed");

    if (isEmbed) {
        ytPlayer.classList.remove("hidden");
        
        let finalUrl = videoSrc;
        if (videoSrc.includes("watch?v=")) {
            const id = videoSrc.split("v=")[1].split("&")[0];
            finalUrl = `https://www.youtube.com/embed/${id}`;
        }
        
        const separator = finalUrl.includes("?") ? "&" : "?";
        ytPlayer.src = `${finalUrl}${separator}autoplay=1&modestbranding=1&rel=0&t=${Date.now()}`;

    } else {
        video.classList.remove("hidden");
        setupStandardVideo(video, videoSrc, ep, epIndex);
    }

    playerModal.classList.remove("hidden");
}

        function showPlayerError(container) {
            const msgDiv = document.createElement("div");
            msgDiv.className = "unavailable-msg absolute inset-0 flex flex-col items-center justify-center text-center p-6 space-y-2 fade-up bg-black";
            msgDiv.innerHTML = `
                <div class="bg-gray-800 p-8 rounded-2xl border border-gray-700 shadow-2xl">
                    <p class="text-white text-lg font-bold">Video Error</p>
                    <p class="text-gray-400 text-sm mb-4">Please contact me in the Discord server and I will fix the episode.</p>
                    <a href="https://discord.gg/jmeYYbBcsN" target="_blank" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-xs font-bold"> Discord</a>
                </div>
            `;
            container.appendChild(msgDiv);
            playerModal.classList.remove("hidden");
        }

function getYouTubeId(url) {
    if (!url) return null;
    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
    const match = url.match(regExp);
    return (match && match[2].length === 11) ? match[2] : null;
}


function setupStandardVideo(video, videoSrc, ep, epIndex) {
    let watchData = JSON.parse(localStorage.getItem("continueWatching") || "[]");
    const currentShowId = currentShow.id;
    const currentSeasonNum = parseInt(seasonSelect.value);
    const existingEntry = watchData.find(item =>
        item.showId === currentShowId && item.season === currentSeasonNum && item.episode === epIndex
    );
    let startTime = existingEntry ? existingEntry.time : 0;

    while (video.firstChild) {
        video.removeChild(video.firstChild);
    }

    if (ep.subtitles && ep.subtitles.length > 0) {
        ep.subtitles.forEach(track => {
            fetch(track.url)
                .then(response => response.blob())
                .then(blob => {
                    const blobUrl = URL.createObjectURL(blob);
                    const t = document.createElement("track");
                    t.kind = "subtitles";
                    t.label = track.label;
                    t.srclang = track.lang;
                    t.src = blobUrl;
                    if (track.default) t.default = true;
                    video.appendChild(t);
                })
                .catch(err => console.error("Subtitle fetch failed:", err));
        });
    }

    video.ontimeupdate = () => {
        const currentTime = video.currentTime;
        const duration = video.duration;
        const nextBtn = document.getElementById("nextEpOverlay");

        if (currentTime > 0) saveProgress(currentShowId, currentSeasonNum, epIndex, currentTime);

        if (nextBtn && duration > 0 && (duration - currentTime) <= 15) {
            if (currentEpisodeIndex < currentSeasonData.episodes.length - 1) {
                const nextEp = currentSeasonData.episodes[currentEpisodeIndex + 1];
                document.getElementById("nextEpPreview").src = nextEp.thumbnail;
                document.getElementById("nextEpTitle").textContent = nextEp.title;
                nextBtn.classList.remove("hidden");
            }
        } else if (nextBtn) {
            nextBtn.classList.add("hidden");
        }
    };

    video.onended = () => playNextEpisode();

    const onVideoReady = () => {
        if (startTime > 0) video.currentTime = startTime;
        video.play().catch(e => console.log("Auto-play prevented"));
    };

    if (videoSrc.includes('.m3u8') && Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(videoSrc);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, onVideoReady);
    } else {
        video.src = videoSrc;
        video.addEventListener('loadedmetadata', onVideoReady, { once: true });
    }
}

        function playNextEpisode() {
            if (currentEpisodeIndex < currentSeasonData.episodes.length - 1) {
                openPlayer(currentEpisodeIndex + 1);
            } else {
                closePlayer();
            }
        }

        function playPreviousEpisode() {
            if (currentEpisodeIndex > 0) {
                openPlayer(currentEpisodeIndex - 1);
            }
        }

        document.addEventListener('keydown', (e) => {
            if (document.getElementById("playerModal").classList.contains('hidden')) return;

            if (e.shiftKey && e.key.toLowerCase() === 'n') {
                e.preventDefault();
                playNextEpisode();
            }
            if (e.shiftKey && e.key.toLowerCase() === 'p') {
                e.preventDefault();
                playPreviousEpisode();
            }
        });

        function saveProgress(showId, season, episode, time) {
            let watchData = JSON.parse(localStorage.getItem("continueWatching") || "[]");
            
            watchData = watchData.filter(item => item.showId !== showId);

            watchData.unshift({
                showId: showId,
                season: season,
                episode: episode,
                time: time,
                lastUpdated: Date.now()
            });

            if(watchData.length > 10) watchData.pop();

            localStorage.setItem("continueWatching", JSON.stringify(watchData));
        }

let heroData = [];
let currentHeroIndex = 0;

fetch("data/hero.json?v=" + Date.now())
    .then(res => res.json())
    .then(data => {
        heroData = data.featured;
        if (heroData.length > 0) {
            document.getElementById('heroSection').classList.remove('hidden');
            renderHero();
            setInterval(nextHero, 8000);
        }
    });

function renderHero() {
    const container = document.getElementById("heroContainer");
    const item = heroData[currentHeroIndex];
    
    const showIndex = shows.findIndex(s => s.id === item.showId);

    container.innerHTML = `
        <div class="absolute inset-0 bg-cover bg-center transition-all duration-1000" 
             style="background-image: url('${item.heroBanner}')">
            <div class="absolute inset-0 bg-gradient-to-r from-black/80 via-black/40 to-transparent"></div>
        </div>
        
        <div class="relative h-full flex flex-col justify-center px-8 md:px-16 max-w-2xl space-y-4 fade-up">
            <h2 class="text-3xl md:text-5xl font-black text-white">${item.title}</h2>
            <p class="text-gray-200 text-sm md:text-base line-clamp-3">${item.description}</p>
            
            <div class="flex gap-4 pt-2">
                <button onclick="openShow(${showIndex})" 
                        class="px-8 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl transition-all active:scale-95 shadow-lg">
                    View Details
                </button>
                
                <div class="flex gap-2">
                    <button onclick="prevHero()" class="p-3 glass rounded-xl text-white hover:bg-white/20">❮</button>
                    <button onclick="nextHero()" class="p-3 glass rounded-xl text-white hover:bg-white/20">❯</button>
                </div>
            </div>
        </div>
    `;
}

function nextHero() {
    currentHeroIndex = (currentHeroIndex + 1) % heroData.length;
    renderHero();
}

function prevHero() {
    currentHeroIndex = (currentHeroIndex - 1 + heroData.length) % heroData.length;
    renderHero();
}

function closeShow() {
    clearTimeout(previewTimer); 
    const videoEl = document.getElementById("showPreviewVideo");
    videoEl.pause();
    videoEl.src = ""; 

    showModal.classList.add("hidden");
    document.body.classList.remove("modal-open");
    renderContinueWatching(); 
    if(lastFocusedElement) lastFocusedElement.focus();
}

        function closePlayer() {
            const video = document.getElementById("playerVideo");
            const videoContainer = video.parentElement;

            const errorMsg = videoContainer.querySelector('.unavailable-msg');
            if (errorMsg) errorMsg.remove();
            
            video.classList.remove("hidden");

            video.ontimeupdate = null;

            video.pause();
            video.src = "";
            if (hls) {
                hls.destroy();
                hls = null;
            }
            playerModal.classList.add("hidden");

            renderContinueWatching();

            setTimeout(() => {
                const buttons = episodeGrid.querySelectorAll('button');
                if (buttons.length > 0) buttons[0].focus();
            }, 100);
        }
    </script>
    
    <section class="max-w-6xl mx-auto px-6 py-24">
        <h2 class="text-4xl font-extrabold mb-10 text-center">
            FAQ
        </h2>

        <div class="space-y-4">

            <div class="faq-item rounded-xl bg-white/70 dark:bg-gray-800/70 backdrop-blur shadow-md">
                <button class="w-full px-6 py-5 flex justify-between items-center text-left font-semibold text-lg focus:ring-4 focus:ring-indigo-500 rounded-xl outline-none"
                    onclick="toggleFAQ(this)">
                    <span>What is this site?</span>
                    <span class="faq-icon text-xl">+</span>
                </button>

                <div class="faq-content hidden px-6 pb-5 text-gray-600 dark:text-gray-300">
                    This site is a website you can stream most LEGO TV shows on.
                </div>
            </div>


            <div class="faq-item rounded-xl bg-white/70 dark:bg-gray-800/70 backdrop-blur shadow-md">
                <button class="w-full px-6 py-5 flex justify-between items-center text-left font-semibold text-lg focus:ring-4 focus:ring-indigo-500 rounded-xl outline-none"
                    onclick="toggleFAQ(this)">
                    <span>Where does the video content come from?</span>
                    <span class="faq-icon text-xl">+</span>
                </button>

                <div class="faq-content hidden px-6 pb-5 text-gray-600 dark:text-gray-300">
                    Videos are embedded or streamed from official sources.
                </div>
            </div>

            <div class="faq-item rounded-xl bg-white/70 dark:bg-gray-800/70 backdrop-blur shadow-md">
                <button class="w-full px-6 py-5 flex justify-between items-center text-left font-semibold text-lg focus:ring-4 focus:ring-indigo-500 rounded-xl outline-none"
                    onclick="toggleFAQ(this)">
                    <span>Why is some content marked as “Coming Soon”?</span>
                    <span class="faq-icon text-xl">+</span>
                </button>

                <div class="faq-content hidden px-6 pb-5 text-gray-600 dark:text-gray-300">
                    Some shows or seasons are still being prepared and will be available at a later date.
                </div>
            </div>

            <div class="faq-item rounded-xl bg-white/70 dark:bg-gray-800/70 backdrop-blur shadow-md">
                <button class="w-full px-6 py-5 flex justify-between items-center text-left font-semibold text-lg focus:ring-4 focus:ring-indigo-500 rounded-xl outline-none"
                    onclick="toggleFAQ(this)">
                    <span>How do I suggest a new feature to the website?</span>
                    <span class="faq-icon text-xl">+</span>
                </button>

                <div class="faq-content hidden px-6 pb-5 text-gray-600 dark:text-gray-300">
                    Join the Discord server.
                </div>
            </div>

        </div>
    </section>

</body>
</html>
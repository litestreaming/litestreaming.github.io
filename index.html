<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Litestreaming</title>

    <!-- Tailwind -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <style>
        .glass {
            backdrop-filter: blur(12px);
            background: rgba(0, 0, 0, 0.6);
        }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

    <!-- NAV -->
    <nav class="fixed top-0 w-full z-20 backdrop-blur bg-white/30 dark:bg-gray-800/30 border-b border-gray-300/20">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between">
            <span class="font-bold text-xl">Litestreaming</span>
        </div>
    </nav>

    <!-- POSTER GRID -->
    <main class="pt-24 max-w-7xl mx-auto px-6">
        <h1 class="text-4xl font-extrabold mb-6">Featured Shows</h1>
        <div id="posterGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6"></div>
    </main>

    <!-- SHOW MODAL -->
    <div id="showModal" class="fixed inset-0 hidden z-40">
        <div class="absolute inset-0 bg-black/70" onclick="closeShow()"></div>

        <div class="relative max-w-5xl mx-auto mt-20 glass rounded-2xl overflow-hidden shadow-2xl">
            <div id="showHero" class="h-72 bg-cover bg-center relative">
                <img id="showLogo" class="absolute bottom-4 left-6 h-20" />
            </div>

            <div class="p-6 space-y-6">
                <p id="showSummary" class="text-gray-300 max-w-3xl"></p>

                <!-- SEASON SELECT -->
                <select id="seasonSelect" class="bg-gray-800 p-3 rounded-xl w-64 text-white">
                </select>

                <!-- EPISODE GRID -->
                <div id="episodeGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4
         max-h-[40vh] overflow-y-auto pr-2">
                </div>

            </div>
        </div>
    </div>

    <!-- PLAYER MODAL -->
    <div id="playerModal" class="fixed inset-0 hidden z-50">
        <div class="absolute inset-0 bg-black/80" onclick="closePlayer()"></div>

        <div class="relative max-w-5xl mx-auto mt-24 bg-black rounded-2xl overflow-hidden">
            <iframe id="playerFrame" width="100%" height="450" frameborder="0" allowfullscreen></iframe>
        </div>
    </div>

    <script>
        let shows = [];
        let currentShow = null;
        let currentSeasonData = null;

        /* LOAD SHOW LIST */
        fetch("data/show.json")
            .then(res => res.json())
            .then(data => {
                shows = data.shows;
                renderPosters();
            });

        /* POSTERS */
        function renderPosters() {
            posterGrid.innerHTML = shows.map((show, i) => `
    <img src="${show.poster}"
      class="rounded-xl shadow-lg hover:scale-105 transition cursor-pointer"
      onclick="openShow(${i})" />
  `).join("");
        }

        /* OPEN SHOW */
        function openShow(index) {
            currentShow = shows[index];

            showHero.style.backgroundImage = `url(${currentShow.banner})`;
            showLogo.src = currentShow.logo;
            showSummary.textContent = currentShow.summary;

            seasonSelect.innerHTML = currentShow.seasons.map((s, i) =>
                `<option value="${i}">Season ${s.number}</option>`
            ).join("");

            seasonSelect.onchange = () => loadSeason(seasonSelect.value);
            loadSeason(0);

            showModal.classList.remove("hidden");
        }

        /* LOAD SEASON JSON */
        function loadSeason(seasonIndex) {
            fetch(currentShow.seasons[seasonIndex].file)
                .then(res => res.json())
                .then(data => {
                    currentSeasonData = data;
                    renderEpisodes();
                });
        }

        /* EPISODES */
        function renderEpisodes() {
            episodeGrid.innerHTML = currentSeasonData.episodes.map((ep, i) => `
    <div onclick="openPlayer(${i})"
      class="bg-gray-800 rounded-xl overflow-hidden cursor-pointer hover:scale-105 transition">
      <img src="${ep.thumbnail}" class="w-full h-32 object-cover">
      <div class="p-3">
        <p class="text-xs text-gray-400">Episode ${ep.number}</p>
        <p class="font-semibold">${ep.title}</p>
      </div>
    </div>
  `).join("");
        }

        /* PLAYER */
        function openPlayer(epIndex) {
            playerFrame.src = currentSeasonData.episodes[epIndex].embed;
            playerModal.classList.remove("hidden");
        }

        /* CLOSES */
        function closeShow() {
            showModal.classList.add("hidden");
        }

        function closePlayer() {
            playerModal.classList.add("hidden");
            playerFrame.src = "";
        }
    </script>

</body>

</html>
